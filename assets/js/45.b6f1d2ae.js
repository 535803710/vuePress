(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{460:function(e,d,v){"use strict";v.r(d);var _=v(62),o=Object(_.a)({},(function(){var e=this,d=e.$createElement,v=e._self._c||d;return v("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[v("h1",{attrs:{id:"参数"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#参数"}},[e._v("#")]),e._v(" 参数")]),e._v(" "),v("ol",[v("li",[e._v("n1 - 旧的节点")]),e._v(" "),v("li",[e._v("n2 - 新的节点")]),e._v(" "),v("li",[e._v("container 挂载点")])]),e._v(" "),v("h1",{attrs:{id:"思路"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#思路"}},[e._v("#")]),e._v(" 思路")]),e._v(" "),v("ol",[v("li",[e._v("循环遍历 比较\n"),v("ol",[v("li",[e._v("是否被处理过（6 中的非理想情况）。")]),e._v(" "),v("li",[e._v("新首-旧首，打补丁，新首节点索引+1，旧首节点索引+1。")]),e._v(" "),v("li",[e._v("新尾-旧尾，打补丁，新尾节点索引-1，旧尾节点索引-1。")]),e._v(" "),v("li",[e._v("新尾-旧首，打补丁，旧首对应的 DOM 移动到旧尾节点的后面，新尾节点索引-1，旧首节点索引+1。")]),e._v(" "),v("li",[e._v("新首-旧尾，打补丁，旧尾对应的 DOM 移动到旧首节点的前面，新首节点索引+1，旧尾节点索引-1。")]),e._v(" "),v("li",[e._v("考虑非理想情况 在旧节点组中找新首。找到则将 DOM 移动到最前，且在旧节点组中设为 undefined；没找到则添加新元素到最前。")])])]),e._v(" "),v("li",[e._v("如果有新节点剩下，遍历剩下的新节点，挂载到当前旧节点组的头部节点。")]),e._v(" "),v("li",[e._v("如果有旧节点剩下，遍历剩下的旧节点，卸载。")])]),e._v(" "),v("h1",{attrs:{id:"流程图"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#流程图"}},[e._v("#")]),e._v(" 流程图")]),e._v(" "),v("h2",{attrs:{id:"准备工作"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#准备工作"}},[e._v("#")]),e._v(" 准备工作")]),e._v(" "),v("p",[v("img",{attrs:{src:"https://pub-a953275fa2c34c18b80fc1f84e3ea746.r2.dev/xiaowo/2023/08/1f3ec2b44dad4fb023c3c0093c28240f.png",alt:""}})]),e._v(" "),v("h2",{attrs:{id:"循环开始"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#循环开始"}},[e._v("#")]),e._v(" 循环开始")]),e._v(" "),v("p",[v("img",{attrs:{src:"https://pub-a953275fa2c34c18b80fc1f84e3ea746.r2.dev/xiaowo/2023/08/71bc38d2b18e7075b2940f4ad6b36408.png",alt:""}})]),e._v(" "),v("p",[v("img",{attrs:{src:"https://pub-a953275fa2c34c18b80fc1f84e3ea746.r2.dev/xiaowo/2023/08/0f493f81f0cd2c53b3d1ea8a02b97d38.png",alt:""}})]),e._v(" "),v("p",[v("img",{attrs:{src:"https://pub-a953275fa2c34c18b80fc1f84e3ea746.r2.dev/xiaowo/2023/08/48bddd57d33e673734fa5741ea6aa39b.png",alt:""}})]),e._v(" "),v("h2",{attrs:{id:"循环完成-检查新增或者卸载"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#循环完成-检查新增或者卸载"}},[e._v("#")]),e._v(" 循环完成，检查新增或者卸载")]),e._v(" "),v("p",[v("img",{attrs:{src:"https://pub-a953275fa2c34c18b80fc1f84e3ea746.r2.dev/xiaowo/2023/08/0a96e217947b52360427b3a18a2ea56f.png",alt:""}})]),e._v(" "),v("h1",{attrs:{id:"实现步骤"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#实现步骤"}},[e._v("#")]),e._v(" 实现步骤")]),e._v(" "),v("ul",[v("li",[v("p",[e._v("定义 "),v("code",[e._v("oldChildren")]),e._v(" 为 n1 的 "),v("code",[e._v("children")])])]),e._v(" "),v("li",[v("p",[e._v("定义 "),v("code",[e._v("newChildren")]),e._v(" 为 n2 的 "),v("code",[e._v("children")]),e._v("\n// 定义四个索引值")])]),e._v(" "),v("li",[v("p",[e._v("定义 "),v("code",[e._v("oldStartIndex")]),e._v(" 为 "),v("code",[e._v("oldChildren")]),e._v(" 的首位索引值")])]),e._v(" "),v("li",[v("p",[e._v("定义 "),v("code",[e._v("oldEndIndex")]),e._v(" 为 "),v("code",[e._v("oldChildren")]),e._v(" 的最后位索引值")])]),e._v(" "),v("li",[v("p",[e._v("定义 "),v("code",[e._v("newStartIndex")]),e._v(" 为 "),v("code",[e._v("newChildren")]),e._v(" 的首位索引值")])]),e._v(" "),v("li",[v("p",[e._v("定义 "),v("code",[e._v("newEndIndex")]),e._v(" 为 "),v("code",[e._v("newChildren")]),e._v(" 的最后位索引值\n// 定义四个索引所对应的 VNode 节点")])]),e._v(" "),v("li",[v("p",[e._v("定义 "),v("code",[e._v("oldStartVNode")]),e._v(" 为 "),v("code",[e._v("oldChildren[oldStartIndex]")])])]),e._v(" "),v("li",[v("p",[e._v("定义 "),v("code",[e._v("oldEndVNode")]),e._v(" 为 "),v("code",[e._v("oldChildren[oldEndIndex]")])])]),e._v(" "),v("li",[v("p",[e._v("定义 "),v("code",[e._v("newStartVNode")]),e._v(" 为 "),v("code",[e._v("newChildren[newStartIndex]")])])]),e._v(" "),v("li",[v("p",[e._v("定义 "),v("code",[e._v("newEndVNode")]),e._v(" 为 "),v("code",[e._v("newChildren[newEndIndex]")]),e._v("\n// 进行比较")])]),e._v(" "),v("li",[v("p",[e._v("循环？"),v("code",[e._v("newStartIndex <= newEndIndex")]),e._v(" 且 "),v("code",[e._v("oldStartIndex <= oldEndIndex")])]),e._v(" "),v("ol",[v("li",[v("p",[e._v("oldStartVNode 不存在的话？ 说明该节点已经处理过了")]),e._v(" "),v("ul",[v("li",[e._v("将 "),v("code",[e._v("oldStartVNode")]),e._v(" 指向 "),v("code",[e._v("oldChildren[++oldStartIndex]")])])])]),e._v(" "),v("li",[v("p",[v("code",[e._v("oldStartVNode.key === newStartVNode.key")]),e._v(" ?")]),e._v(" "),v("ul",[v("li",[e._v("调用 "),v("code",[e._v("patch(oldStartVNode,newStartVNode,container)")]),e._v("打补丁")]),e._v(" "),v("li",[e._v("将 "),v("code",[e._v("oldStartVNode")]),e._v(" 指向 "),v("code",[e._v("oldChildren[++oldStartIndex]")])]),e._v(" "),v("li",[e._v("将 "),v("code",[e._v("newStartVNode")]),e._v(" 指向 "),v("code",[e._v("newChildren[++newStartIndex]")])])])]),e._v(" "),v("li",[v("p",[v("code",[e._v("oldEndVNode.key === newEndVNode.key")]),e._v(" ?")]),e._v(" "),v("ul",[v("li",[e._v("调用 "),v("code",[e._v("patch(oldStartVNode, newStartVNode, container)")]),e._v("打补丁")]),e._v(" "),v("li",[e._v("将 "),v("code",[e._v("oldEndVNode")]),e._v(" 指向 "),v("code",[e._v("oldChildren[--oldEndIndex]")])]),e._v(" "),v("li",[e._v("将 "),v("code",[e._v("newStartVNode")]),e._v(" 指向 "),v("code",[e._v("newChildren [--newStartIndex]")])])])]),e._v(" "),v("li",[v("p",[v("code",[e._v("oldStartVNode.key === newEndVNode.key")]),e._v(" ?")]),e._v(" "),v("ul",[v("li",[e._v("调用 "),v("code",[e._v("patch(oldStartVNode, newEndVNode, container )")]),e._v("打补丁")]),e._v(" "),v("li",[e._v("调用 "),v("code",[e._v("insert(oldStartVNode.el ,container ,oldEndVNode.el.nextSiling )")]),e._v(" 将 "),v("code",[e._v("oldStartVNode")]),e._v(" 移动到 "),v("code",[e._v("oldEndVNode")]),e._v("的下一个节点 前")]),e._v(" "),v("li",[e._v("将 "),v("code",[e._v("oldStartVNode")]),e._v(" 指向 "),v("code",[e._v("oldChildren [ ++oldStartIndex ]")])]),e._v(" "),v("li",[e._v("将 "),v("code",[e._v("newEndVNode")]),e._v(" 指向 "),v("code",[e._v("newChildren[ --newEndIndex ]")])])])]),e._v(" "),v("li",[v("p",[v("code",[e._v("oldEndVNode.key === newStartVNode.key")]),e._v(" ?")]),e._v(" "),v("ul",[v("li",[e._v("调用 "),v("code",[e._v("patch( oldEndVNode, newStartVNode , container )")]),e._v("打补丁")]),e._v(" "),v("li",[e._v("调用 "),v("code",[e._v("insert ( oldEndVNode.el , container , oldStartVNode.el )")]),e._v(" 将 "),v("code",[e._v("oldEndVNode")]),e._v(" 移动到 "),v("code",[e._v("oldStartVNode")]),e._v(" 前")]),e._v(" "),v("li",[e._v("将 "),v("code",[e._v("oldEndVNode")]),e._v(" 指向 "),v("code",[e._v("oldChildren [ --oldEndIndex ]")])]),e._v(" "),v("li",[e._v("将 "),v("code",[e._v("newStartVNode")]),e._v(" 指向 "),v("code",[e._v("newChildren[ ++newStartIndex ]")])])])]),e._v(" "),v("li",[v("p",[e._v("以上都不满足")]),e._v(" "),v("ul",[v("li",[e._v("定义 "),v("code",[e._v("idxInOld")]),e._v(" , 遍历 "),v("code",[e._v("oldChildren")]),e._v(" ，找是否有和 "),v("code",[e._v("newStartVNode")]),e._v(" 相同的 "),v("code",[e._v("key")]),e._v(" ?")]),e._v(" "),v("li",[v("code",[e._v("idxInOld > 0 在 oldChildren")]),e._v(" 中找到和 "),v("code",[e._v("newStartVNode")]),e._v(" 相同的 "),v("code",[e._v("key")]),e._v(" "),v("ul",[v("li",[e._v("定义 "),v("code",[e._v("vnodeToMove")]),e._v(" 为 "),v("code",[e._v("oldChildren[idxInOld]")])]),e._v(" "),v("li",[e._v("调用 "),v("code",[e._v("patch( vnodeToMove, newStartVNode , container )")]),e._v("打补丁")]),e._v(" "),v("li",[e._v("调用 "),v("code",[e._v("insert ( vnodeToMove.el , container , oldStartVNode.el )")]),e._v(" 将 "),v("code",[e._v("vnodeToMove")]),e._v(" 移动到 "),v("code",[e._v("oldStartVNode")]),e._v(" 前")]),e._v(" "),v("li",[e._v("将 "),v("code",[e._v("oldChildren[idxInOld]")]),e._v(" 设置为 "),v("code",[e._v("undefined")])])])]),e._v(" "),v("li",[v("code",[e._v("idxInOld < 0")]),e._v(" 没有找到\n"),v("ul",[v("li",[e._v("调用 "),v("code",[e._v("patch(null,newStartVNode,container,oldStartVNode.el)")]),e._v(", 添加 "),v("code",[e._v("newStartVNode")])]),e._v(" "),v("li",[e._v("将 "),v("code",[e._v("newStartVNode")]),e._v(" 指向 "),v("code",[e._v("newChildren[ ++newStartIndex ]")])])])])])])])]),e._v(" "),v("li",[v("p",[v("code",[e._v("oldEndIndex < oldStartIndex && newEndIndex <= newStartIndex")]),e._v(" 检查索引的情况，看是否有需要新增的节点")]),e._v(" "),v("ul",[v("li",[e._v("循环剩下的新节点 然后调用 "),v("code",[e._v("patch(null,newChildren[i],container,oldStartVNode.el)")]),e._v(" 新增到 oldStartVNode 前")])])]),e._v(" "),v("li",[v("p",[v("code",[e._v("newEndIndex < newStartIndex && oldEndIndex >= oldStartIndex")]),e._v(" 检查是否有需要删除的节点")]),e._v(" "),v("ul",[v("li",[e._v("循环剩下的旧节点，然后调用 "),v("code",[e._v("unmount(oldChildren[i])")])])])])]),e._v(" "),v("h1",{attrs:{id:"总结"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[e._v("#")]),e._v(" 总结")]),e._v(" "),v("p",[e._v("双端diff算法指的就是在新旧两组节点的四个端点分别进行比较，并试图找到可用节点。相比较"),v("a",{attrs:{href:"https://juejin.cn/post/7077875160425955342",target:"_blank",rel:"noopener noreferrer"}},[e._v("简单diff算法"),v("OutboundLink")],1),e._v("，同样的场景下，DOM移动次数更少。")])])}),[],!1,null,null,null);d.default=o.exports}}]);